<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel ="stylesheet" type="text/css" href="style.css"> 
  
  <title>Resilient Rebuilding Guide (USGBC-aligned)</title>
  <meta name="description" content="Interactive post-fire rebuilding guide aligned with USGBC/green-resilience principles: water resilience, home hardening, hubs, equity, and monitoring." />
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <link rel="preconnect" href="https://{s}.tile.openstreetmap.org" crossorigin>
  <link
    rel="stylesheet"
    href="https://unpkg.com/modern-css-reset/dist/reset.min.css"
  />
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <!-- Cesium ion Story Viewer dependencies -->
  <script src="https://cesium.com/downloads/cesiumjs/releases/1.95/Build/Cesium/Cesium.js"></script>
  <link href="https://cesium.com/downloads/cesiumjs/releases/1.95/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
  <script src="https://ajax.googleapis.com/ajax/libs/webcomponentsjs/2.4.4/webcomponents-loader.js"></script>
  <script src="https://unpkg.com/pepjs@0.5.2/dist/pep.min.js"></script>
</head>
<body>
<div class="app">
  <button class="show-sidebar" id="showSidebar">☰ Menu</button>
  <nav id="sidebar">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <h1>Rebuilding Guide</h1>
      <button id="hideSidebar" class="hide-btn" title="Hide sidebar">×</button>
    </div>
    <div class="search">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.2-4.2M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
      <input id="search" placeholder="Search sections…" />
    </div>
    <div class="toc" id="toc">
      <div class="group">Guide</div>
      <a href="#overview">Overview</a>
      <a href="#risk">Risk & Damage</a>
      
      <a href="#hubs">Recovery Hubs</a>
      <a href="#water">Water Resilience</a>
      <a href="#mobility">Mobility & Transit</a>
      <a href="#green">Green & Resilient Rebuild</a>
      <a href="#equity">Equity & Housing</a>
      <a href="#monitoring">Monitoring & Feedback</a>
      <div class="group">Tools</div>
      <a href="#cesium-story">3D Story Viewer</a>
      <a href="#tools">Tools & Checklists</a>
      <a href="#adu">ADU Explorer</a>
      <a href="#wildfire-tools">Wildfire Events</a>
      <a href="#mapSection">Map</a>
      
    </div>
  </nav>
  <main>
    <section class="hero" id="overview">
      <div>
        <span class="badge">USGBC-aligned • Wildfire Resilience</span>
		<br>
        <h2>Resilient, Equitable, Community-Oriented Rebuilding</h2>
        <p>
          This interactive guide distills the recovery strategy into actionable steps:
          home hardening, water and energy resilience, equitable resource access, and adaptive monitoring.
          It references demographic vulnerabilities, distributed water storage, key recovery hubs, and green
          design guidance (see pages 4–5, 10–17, 20–27 of your plan).<sup class="small">[Source]</sup>
        </p>
        <div class="actions">
          <button class="btn brand" onclick="window.print()">Print / Save as PDF</button>
          <button class="btn" id="expandAll">Expand all</button>
          <button class="btn" id="collapseAll">Collapse all</button>
        </div>
        <div class="kpis" style="margin-top:10px">
          <div class="k"><div class="small">Minority pop.</div><strong>~72%</strong></div>
          <div class="k"><div class="small">Seniors 65+</div><strong>~16%</strong></div>
          <div class="k"><div class="small">Pre-1970 homes</div><strong>~86%</strong></div>
          <div class="k"><div class="small">Tree canopy</div><strong>~12%</strong></div>
        </div>
      </div>
      <div class="panel">
        <h3>Quick Links</h3>
        <div class="chips">
          <a class="chip" href="#tools">Home-Hardening Checklist</a>
          <a class="chip" href="#water">Water Storage Sizing</a>
          <a class="chip" href="#equity">Equity & Housing Aid</a>
          <a class="chip" href="#monitoring">Monitoring Dashboard Ideas</a>
        </div>
        <div class="highlight" style="margin-top:12px">
          <strong>Note:</strong> This guide “USGBC-style” aligns to energy efficiency, fire-resistant materials,
          onsite renewables + storage, stormwater management, and nature-based buffers (pp. 16–17).<sup class="small">[Source]</sup>
        </div>
      </div>
    </section>
    <section class="panel accordion" id="risk">
      <summary><h3>Risk & Damage: What to Prioritize First</h3></summary>
      <div class="meta">Based on the plan’s geospatial damage & hazard analysis (pp. 8–9).</div>
      <details open>
        <summary><strong>High-risk areas & actions</strong></summary>
      </details>
      <details>
        <summary><strong>Environmental vulnerabilities</strong></summary>
        </ul>
        <p class="note">Environmental context summarized from p.7 of the plan.<sup class="small">[Source]</sup></p>
      </details>
    </section>
    <section class="panel accordion" id="hubs">
      <summary><h3>Community Recovery Hubs & Key Facilities</h3></summary>
      <div class="meta">Hubs, health providers, schools, parks, water providers, and fire stations (pp. 10–12).</div>
      <details open>
        <summary><strong>Primary hubs</strong></summary>
        <ul>
          <li><em>540 W Woodbury Rd</em> — permanent disaster recovery center.</li>
          <li>Pasadena Disaster Recovery Center • Pasadena City College workshops • Flintridge Center.</li>
          <li>Convention Center (large-scale logistics & outreach).</li>
        </ul>
      </details>
      <details>
        <summary><strong>Supporting network</strong></summary>
        <ul>
          <li>Health: AltaMed, KP Medical, Pasadena Public Health, Wesley Health, CHAP, etc.</li>
          <li>Schools as recovery anchors: Longfellow, Washington STEM Magnet, Altadena Arts Magnet, etc.</li>
          <li>Parks: Washington, Triangle, La Pintoresca, Loma Alta, Farnsworth, Hahamongna.</li>
          <li>Water: Lincoln Ave Water Co, Rubio Canon L&W, Las Flores, Foothill MWD.</li>
          <li>Fire Stations: LACoFD 11, 12, 66; Pasadena FD 32, 33, 36, 38 (air-quality monitoring at Station 11).</li>
        </ul>
      </details>
    </section>
    <section class="panel accordion" id="water">
      <summary><h3>Integrated Water Resilience</h3></summary>
      <div class="meta">Mandatory site-level harvesting, distributed storage, greywater, neighborhood networks, and monitoring (pp. 12–13).</div>
      <details open>
        <summary><strong>Key elements</strong></summary>
        <ul>
          <li>Rooftop catchment with tanks sized for <em>domestic + emergency fire</em> draw-off.</li>
          <li>Public/institutional cistern nodes at schools, parks, fire stations, hospitals.</li>
          <li>Greywater reuse; bioswales/rain gardens; smart meters & pressure sensors.</li>
          <li>Mutual-aid water sharing agreements; targeted infrastructure hardening.</li>
        </ul>
      </details>
    </section>
    <section class="panel accordion" id="mobility">
      <summary><h3>Mobility, Transit & Emergency Functions</h3></summary>
      <div class="meta">Altadena/Lake & Fair Oaks/Altadena nodes, frequencies, equity metrics, and emergency roles (pp. 14–15).</div>
      <details open>
        <summary><strong>Key nodes & opportunities</strong></summary>
        <ul>
          <li>Altadena/Lake: ~3 trips/hr peak; Fair Oaks/Altadena: ~2–2.5 trips/hr; improve midday & weekend gaps.</li>
          <li>Upgrade stops (shade, seating, real-time info) & integrate corridors with green infrastructure.</li>
          <li>Use established routes for evacuation drills, relief staging, and medical access continuity.</li>
        </ul>
      </details>
    </section>
    <section class="panel accordion" id="green">
      <summary><h3>Green & Resilient Rebuilding Guidelines</h3></summary>
      <div class="meta">Energy efficiency, renewables + storage, fire-resistant materials, stormwater, equity, urban forestry (pp. 16–17).</div>
      <details open>
        <summary><strong>Design checklist</strong></summary>
        <ul>
          <li>High-performance envelope; efficient HVAC; daylighting.</li>
          <li>Solar PV + battery storage for outage resilience.</li>
          <li>Non-combustible cladding, tempered glazing, ember-resistant vents.</li>
          <li>Defensible-space landscaping with native, drought-tolerant plants.</li>
          <li>Permeable surfaces, bioswales, and retention basins to manage stormwater onsite.</li>
        </ul>
      </details>
    </section>
    <section class="panel accordion" id="equity">
      <summary><h3>Equity-Centered Resource Allocation & Housing</h3></summary>
      <div class="meta">Prioritize low-income, seniors, renters; transparent criteria; anti-displacement measures (pp. 22–23).</div>
      <details open>
        <summary><strong>Implementation</strong></summary>
        <ul>
          <li>Grants/loans for severely impacted households; insurance navigation & legal aid.</li>
          <li>Rebuild affordable rentals; incentives for landlords to maintain affordability.</li>
          <li>Link rent stabilization to recovery funding; publish disaggregated progress metrics.</li>
        </ul>
      </details>
    </section>
    <section class="panel accordion" id="monitoring">
      <summary><h3>Monitoring, Feedback & Adaptive Implementation</h3></summary>
      <div class="meta">Real-time dashboards, community reporting loops, and agile governance (pp. 20–21).</div>
      <details open>
        <summary><strong>Dashboard ideas</strong></summary>
        <ul>
          <li>Permit cycle times; rebuild starts/completions; water system uptime; AQI & asthma visits.</li>
          <li>Public hub events, CERT participation, equity distribution maps.</li>
          <li>“Adjustments log” to record policy/process fixes triggered by data or community input.</li>
        </ul>
      </details>
    </section>


     <!-- Cesium ion Story Viewer -->
    <section class="panel" id="cesium-story">
      <h3>3D Story Viewer</h3>
      <p class="small">Interactive 3D visualization from Cesium ion. Use mouse/touch to navigate the scene.</p>
      
      <div class="cesium-container" style="height: 600px; position: relative; border-radius: 8px; overflow: hidden;">
        <iframe 
          src="https://ion.cesium.com/stories/viewer/?id=3b56607d-2e71-41b9-aa84-682b0be291d6" 
          style="width: 100%; height: 100%; border: none; border-radius: 8px;"
          title="Cesium ion 3D Story Viewer"
          allowfullscreen>
        </iframe>
      </div>
      
      <div class="small" style="margin-top: 12px;">
        <p><strong>Navigation tips:</strong></p>
        <ul>
          <li>Left click + drag to rotate the view</li>
          <li>Right click + drag to zoom in/out</li>
          <li>Middle click + drag to pan</li>
          <li>Use touch gestures on mobile devices</li>
        </ul>
      </div>
    </section>

    <section class="panel" id="tools">
      <h3>Home-Hardening & Safety Tools</h3>
      <div class="grid cols-2">


        <div>
          <h4>Home-Hardening Checklist</h4>
          <div id="checklist" class="checklist">
            <!-- items added by JS -->
          </div>
                    <div class="small" id="progress">0 of 10 completed</div>
        </div>
        <div>
          <h4>Permit & Policy Shortcuts</h4>
          <ul>
            <li>Use expedited permitting pathways for projects meeting resilience standards (pp. 18–19, 26–27).</li>
            <li>Bundle rainwater/greywater and PV+storage in one submission; request fee waivers for survivors.</li>
            <li>Coordinate with mutual water companies early for tank tie-ins and hydrant accessibility.</li>
          </ul>
                  </div>
      </div>
    </section>

    <section class="panel" id="tank-sizing">
      <h3>Tank Sizing Estimator</h3>
      <p class="small">Calculate recommended water tank capacity for rainwater harvesting, firefighting, and domestic use.</p>
      
      <div class="calc">
        <div class="row">
          <label>Roof catchment area (sq ft)
            <input id="roofArea" type="number" value="1500" min="0" />
          </label>
          <label>Annual rainfall (inches)
            <input id="rainIn" type="number" value="18" min="0" />
          </label>
          <label>Capture efficiency
            <select id="eff">
              <option value="0.75" selected>75% (typical)</option>
              <option value="0.85">85% (good)</option>
              <option value="0.9">90% (excellent)</option>
            </select>
          </label>
        </div>
        <div class="row">
          <label>Emergency draw (gpm for firefighting)
            <input id="gpm" type="number" value="10" min="0" />
          </label>
          <label>Fire duration (minutes)
            <input id="minutes" type="number" value="30" min="0" />
          </label>
          <label>Domestic reserve (days @ 50 gpd/person, 3 ppl)
            <input id="days" type="number" value="3" min="0" />
          </label>
        </div>
        <button class="btn brand" id="calcBtn">Calculate</button>
        <p class="result" id="tankResult" aria-live="polite"></p>
        <p class="note">Rule of thumb: gallons harvested ≈ roofArea × rainIn × 0.623 × efficiency. Add fire + domestic reserves.</p>
      </div>
    </section>
	
<section class="panel" id="adu">
  <h3>ADU Explorer: Sustainable Rebuilding Options</h3>
  <p class="small">Explore fire-resilient, water-smart, and equitable accessory dwelling unit (ADU) models suitable for your recovery plan.</p>
  <div class="adu-grid" id="aduGrid"></div>

  <div id="aduViewer" class="adu-viewer" hidden>
    <h4 id="aduTitle"></h4>
    <model-viewer id="aduModel" src="" alt="ADU model" auto-rotate camera-controls ar ar-modes="webxr scene-viewer quick-look" exposure="1.1" shadow-intensity="0.8"></model-viewer>
    <p id="aduDesc" class="small"></p>
    <button class="btn" id="aduClose">Close Viewer</button>
  </div>
</section>

    <!-- Wildfire Events widget -->
    <section class="panel" id="wildfire-tools">
      <h3>Wildfire Events</h3>
      <p class="small">Enter an area and time window. Results will appear below and on the map.</p>

      <form id="wf-form" class="wf-form" novalidate>
        <fieldset class="wf-fieldset">
          <legend><span>Area</span></legend>
          <div class="wf-row">
            <label>Min Longitude <input inputmode="decimal" type="text" id="wfMinLon" value="0"></label>
            <label>Max Longitude <input inputmode="decimal" type="text" id="wfMaxLon" value="0"></label>
            <label>Min Latitude  <input inputmode="decimal" type="text" id="wfMinLat" value="0"></label>
            <label>Max Latitude  <input inputmode="decimal" type="text" id="wfMaxLat" value="0"></label>
          </div>
          <div class="wf-input-help">
            <p class="small"><strong>California bounds:</strong> Long: -125 to -114, Lat: 32 to 42</p>
            <p class="small"><strong>Example:</strong> For Southern CA: Min Lon -118, Min Lat 32, Max Lon -115, Max Lat 35</p>
          </div>
        </fieldset>

        <fieldset class="wf-fieldset">
          <legend><span>Time window</span></legend>
          <div class="wf-row">
            <label>Days look-back <input inputmode="numeric" type="text" id="wfDays" value="0"></label>
            <span class="wf-or" aria-hidden="true">or</span>
            <label>Start <input type="date" id="wfStart"></label>
            <label>End <input type="date" id="wfEnd"></label>
          </div>
          <div class="wf-input-help">
            <p class="small"><strong>Days look-back:</strong> Enter 365 for one year, 30 for one month</p>
            <p class="small"><strong>Date range:</strong> Use date pickers for specific time periods</p>
          </div>
        </fieldset>

        <div class="wf-actions">
          <button type="submit" id="wfRun" class="btn brand">Fetch Wildfires</button>
          <button type="button" id="wfClear" class="btn">Clear</button>
        </div>
      </form>

      <div class="wf-results">
        <div id="wfSummary" class="wf-summary" role="status" aria-live="polite">No data yet.</div>
        
        <div class="wf-chart-container">
          <h4>California Wildfire Trends</h4>
          <canvas id="wildfireChart" width="800" height="400"></canvas>
        </div>
        
        <div class="wf-table-wrap">
          <table class="wf-table" id="wfTable">
            <thead>
              <tr>
                <th>#</th>
                <th>Date</th>
                <th>Title</th>
                <th>Latitude</th>
                <th>Longitude</th>
                <th>Status</th>
                <th>Sources</th>
              </tr>
            </thead>
            <tbody id="wfTbody"></tbody>
          </table>
        </div>
      </div>
    </section>
	
    <!-- ▲▲ Added: Wildfire Events widget ▲▲ -->

    <section class="panel" id="mapSection">
      <h3>Map: Recovery Hubs & Wildfire Events</h3>
      <p class="small">Starter map centered on Altadena. Replace placeholder points with exact coordinates as needed.</p>
      <div id="map" role="region" aria-label="Map of recovery hubs"></div>
    </section>
    <footer>
      <div>Built from your Altadena Fire Rebuild plan (sections: demographics, risk, hubs, water, transit, green rebuild, equity, monitoring). Pages referenced inline above. <strong>Source:</strong> your uploaded PDF.</div>
      <div style="margin-top:6px" class="small">Accessibility: keyboard navigation, focusable controls, reduced motion by OS setting, print stylesheet included.</div>
    </footer>
  </main>
</div>

<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
  crossorigin=""></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="script.js"></script>
  <script>
    // Toggle sidebar visibility
    const hideBtn = document.getElementById('hideSidebar');
    const showBtn = document.getElementById('showSidebar');
    const app = document.querySelector('.app');
    const sidebar = document.getElementById('sidebar');

    // Hide sidebar
    hideBtn.addEventListener('click', () => {
      app.classList.add('sidebar-hidden');
      // Save state in localStorage
      localStorage.setItem('sidebarHidden', 'true');
    });

    // Show sidebar
    showBtn.addEventListener('click', () => {
      app.classList.remove('sidebar-hidden');
      // Remove state from localStorage
      localStorage.removeItem('sidebarHidden');
    });

    // Check for saved state on page load
    if (localStorage.getItem('sidebarHidden') === 'true') {
      app.classList.add('sidebar-hidden');
    }
  </script>
  </body>
</html>
